<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Font+Name">
  <title>Product Page</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Font+Name">

  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Lato:wght@700&display=swap"
    rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Lato:wght@700&display=swap"
    rel="stylesheet">
</head>

<style>
  .truncate-text {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    /* Number of lines to show */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .cart-btn-design {
    right: 20px;
    top: 20px;
    position: absolute;
    background-color: black;
    opacity: 0.7;
    padding: 10px;
    border-radius: 50%;

  }

  .nav-link.active{
    font-family: 'Lato', sans-serif;
}

.btn-product{
    background-color: #092a37;
    color: white;
    margin-top: 15px;
}
.btn-product:hover{
    border: 1px solid #092a37;
    color: #092a37;
}
</style>

<body style="background-color: rgb(249, 247, 247);">
  <nav class="navbar navbar-expand-lg bg-body-tertiary bg-white" style="height: 10vh;background-color: white;margin: 0;">

    <div class="" style="background: white;margin: 0;display: flex;justify-content: space-around;width: 100%;padding: 0 25px;">
        <a class="navbar-brand" style="font-size: 50px; font-family: 'Dancing Script', cursive;color: #092a37;" href="../Home/index.html">Lactancia</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
            aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse " style="display: flex;justify-content: right;" id="navbarText">
            <ul class="navbar-nav  ">
                <li class="nav-item">
                    <a class="nav-link  ps-5" aria-current="page" href="../Home/index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active ps-5" id="nav-products" href="../category/index.html">
                        Categories</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-5" href="../Contact/index.html">Contact
                        Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-5" href="../TermsOfService/index.html">
                        Terms</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-5" href="../PrivacyPolicy/index.html">Privacy Policy</a>
                </li>
                <li class="nav-item" style="position: relative;">
                    <a class="nav-link ps-5" style="color: #092a37;font-size: 18px;" onclick="showCart()" href="#"><i class="fa-solid fa-bag-shopping"></i></a>
                    <div style="position: absolute;top: 0;right: -10px;background-color: tomato;color: white;border-radius: 50%;padding: 3px 5px;font-size: 10px;align-items: center;font-weight: bolder;" id="cart-number">
                        
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link ps-5" style="color: #092a37;font-size: 18px;" href="../LoginPage/index.html"><i
                            class="fa-solid fa-user-large"></i></a>
                </li>

            </ul>
        </div>
    </div>
</nav>

  <div class="row   justify-content-center m-0">

    <div class="col-8 p-5 mt-5 mb-5 " style="background: white;border-radius: 25px;">
      <div>
        <h5 style="font-family: 'Lato', sans-serif;font-size: 24px;">Packed & shipped with care</h5>
       
        <hr class="half-ruler">
      </div>
      <div class="para">
        <p>Fresh products delivered in pristine condition to your home</p>
      </div>
    </div>

  </div>


  <div class="row m-0 justify-content-center ">
    <div class="col-lg-2 col-md-3  ">
      <div class="bg-white p-3 mt-5">
        <p style="font-weight: bold;text-align: center;font-size: 24px;">Filter</p>
        <div class="mt-4">

          <div class="row  mb-2" id="categories">

          </div>

        </div>

        <div >
           <select class="form-select " id="select-price-category" onchange="price_category_filter()">
            <option selected value="-1">Sory By Price</option>
            <option value="lth">Price: Lowest To Highest</option>
            <option value="htl">Price: Highest To Lowest</option>
          </select>
        </div>
        <p style="font-family: 'Lato', sans-serif;font-size: 18px;" class="mt-3">Price</p>
        <div class="form-group">
          <label for="priceRange">Select Price Range Up To:</label>
          <input type="range" style="width: 100%;" id="priceRange" value="0" min="0" max="100" step="1">
        </div>
        <p class="mt-3">Selected Price Range: <span id="selectedPriceRange">$0</span></p>

        <div style="display: flex;justify-content: center;">
          <button class="btn btn-product mb-3" onclick="apply()">Apply</button>

        </div>
       
      </div>
    </div>

    <div class="col-lg-8 col-md-7 col-10  p-3">
      <h3 class="text-center mt-3 mb-3" style="font-family: 'Dancing Script', cursive;font-size: 48px;color: #092a37;" id="cname"></h3>
      
      <div class="products row pl-5 pr-5 pb-5 pt-2" id="products">
      
      </div>
    </div>

  </div>


  <div class="footer" style="background-color: #092a37;color: white; padding: 20px;">
    <div class="socialIcon">
        <a href="" style="background-color: white;"><i class="fa-brands fa-facebook"  target="_blank"></i></a>
        <a style="background-color: white;" href="https://www.instagram.com/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        <a style="background-color: white;" href=""><i class="fa-brands fa-twitter" target="_blank"></i></a>
        <a style="background-color: white;" href=""><i class="fa-brands fa-whatsapp" target="_blank"></i></a>
    </div>
    <div class="footerNav">
        <ul>
            <li ><a href="../Contact/index.html">Contact Us</a></li>
            <li><a href="../TermsOfService/index.html">Terms & Service</a></li>
            <li><a href="../PrivacyPolicy/index.html">Privacy Policy</a></li>
            <!--<li><a href="../Feedback/index.html">Feedback</a></li>-->
        </ul>
    </div>
    <div class="footerbottom">
        <p>2023, Lactancia. All rights reserved</p>
    </div>
</div>

<div class="border" id="cart" style="background-color: white;position: fixed; height: 100vh;width: 350px;top: 0;right: -350px;z-index: 999;">
  <i class="fa fa-arrow-right mt-5 ml-5 mr-5"  style="cursor: pointer;margin-left: 25px;" onclick="hideCart()" aria-hidden="true"></i>

  <h4 class="text-center " style="font-family: 'Dancing Script', cursive;font-size: 40px;color: #092a37;">Cart</h4>

  <div id="cart-box">
    <div class="p-3 mb-1"  style="position: relative;">
      <div class="row  border">
        <div class="col-4">
          <img src="../images/batter.png" style="width: 100%;" />
        </div>
        <div class="col-8">
          <h5>Butter</h5>
          <p class="m-0">Price: CAD 4</p>
          <p class="m-0">Quantity: 2</p>
          
        </div>

        
      </div>

      <a class="btn border" style="position: absolute;top: 20px;right: 10px;">X</a>
    </div>
  </div>

  <div  style="position: absolute;bottom: 10px;left: 50%;transform: translate(-50%,-50%);">
    <a class="btn" style="background-color: #092a37;color: white;" href="../cart/index.html">View Full Cart</a>
  </div>
  
</div>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
    crossorigin="anonymous"></script>

  <script>

showToCart();

   
function showCart(){
  document.getElementById('cart').style.right='0px';
  document.getElementById('cart').style.transition='all 0.5s';
  showToCart();
}

function showToCart(){


var carthtml='';

var storedData = localStorage.getItem("new-cart");

var num=0;
  if (storedData) {
    
    var userData = JSON.parse(storedData);
    //console.log(userData.length);

    if(userData.length==0){
        carthtml='<p style="text-align:center;font-weight:bold;margin-top:25px;">There is no item in the cart.</p>';
        num=0;
    }
    else{
        num=userData.length;
        userData.map((product)=>{
      carthtml+='<div class="p-3 mb-1"  style="position: relative;"><div class="row  border"><div class="col-4">'+
  ' <img src="'+product.img+'" style="width: 100%;" /></div><div class="col-8"><h5>'+product.name+'</h5>'+
    '<p class="m-0">Price: CAD 4</p><p class="m-0">Quantity: '+product.quantity+'</p>  </div></div>'
    })
    }

   
  }
  else{
    carthtml='<p style="text-align:center;font-weight:bold;margin-top:25px;">There is no item in the cart.</p>';
    num=0;
}

  document.getElementById('cart-box').innerHTML=carthtml;
  document.getElementById("cart-number").innerHTML=num;

}

function hideCart(){
  document.getElementById('cart').style.right='-350px';
  document.getElementById('cart').style.transition='all 0.5s';

}



    const priceRange = document.getElementById('priceRange');
    const selectedPriceRange = document.getElementById('selectedPriceRange');

    priceRange.addEventListener('input', () => {
      const value = priceRange.value;
      selectedPriceRange.textContent = '$' + value;
    });

    let categry_name='';

    showcategoryDropDown();
    
    let queryParams = new URLSearchParams(window.location.search);

let id = queryParams.get("c_id");

if (id == null) {
         window.location.replace("/category/index.html")
      }

    function showcategoryDropDown() {

      

      const xhttp = new XMLHttpRequest();
      xhttp.onload = function () {

        var responseJsonObj = JSON.parse(this.responseText);
        //console.log(responseJsonObj);
        let categoryHTML = '<div class="col-12"> <select class="form-select " id="select-category" onchange="categoryfilter()" ><option selected value="-1">Select Categories</option><option  value="all">All</option>';
        responseJsonObj.forEach(category => {
          categoryHTML += '<option value="' + category.id + '">' + category.name + '</option>'
          if(category.id==id){
            categry_name=category.name;
          }
        });

        categoryHTML += "</select></div>";
        document.getElementById('categories').innerHTML = categoryHTML;
        document.getElementById('cname').innerHTML=categry_name+" Products";
      //  console.log(categoryHTML);


      }
      xhttp.open("GET", "http://localhost:3000/category", true);
      xhttp.send();

      showProductAccordCategory();

    }





    function showProductAccordCategory() {

      let queryParams = new URLSearchParams(window.location.search);

      let id = queryParams.get("c_id");
      //console.log("hellow"+id);
      if (id == null) {
        window.location.replace("/category/index.html")
      }
      else {

        const xhttp = new XMLHttpRequest();
        xhttp.onload = function () {

          var responseJsonObj = JSON.parse(this.responseText);
          if(responseJsonObj.length==0){
            window.location.replace("/category/index.html")
          }
          //console.log(responseJsonObj);
          let productcategoryHTML = '';
          responseJsonObj.forEach(product => {



            productcategoryHTML += '<div class="col-lg-4 col-md-6 col-sm-12  p-0"><div class="card m-3" style="box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
              ' <img src="' + product.product_image + '" style="height: 200px;object-fit: cover;"  class="card-img-top" alt="...">' +
              ' <div class="card-body p-3" style="position: relative;">' +
              '<div class="row"><div class="col-6"> <h5 class="card-title text-left" style="font-family: \'Lato\', sans-serif;">' + product.name + '</h5></div>' +
              '<div class="col-6"><p class="card-text  " style="font-weight:bold;text-align:right">CAD ' + product.price + '</p></div></div>' +
              '<p class="card-text truncate-text">' + product.description + '</p> ' +
              ' <a href="../productDetails/index.html?p_id='+product.id+'" class="btn btn-product justify-content-center" style="width:100%">View Detail</a></div>' 


            productcategoryHTML += '</div></div>'
          });

          document.getElementById('products').innerHTML = productcategoryHTML;

          // console.log(productcategoryHTML);


        }
        xhttp.open("GET", "http://localhost:3000/product?category=" + id, true);
        xhttp.send();

      }
    }


    function categoryfilter() {

      var selectElement = document.getElementById("select-category");

      var selectedValue = selectElement.value;
      if (selectedValue == -1) {
        let queryParams = new URLSearchParams(window.location.search);

        selectedValue = queryParams.get("c_id");
       }
      let index=0;
      while(true){

        if(selectElement.options[index].value==selectedValue){

          document.getElementById('cname').innerHTML=selectElement.options[index].text+" Products";
          break;
        }
        index++;
    
      
      }
     
     
      const xhttp = new XMLHttpRequest();
      xhttp.onload = function () {

        var responseJsonObj = JSON.parse(this.responseText);
        //console.log(responseJsonObj);
        let productcategoryHTML = '';
        responseJsonObj.forEach(product => {

          if (selectedValue == 'all') {
            productcategoryHTML += '<div class="col-lg-4 col-md-6 col-sm-12  p-3"><div class="card" style="box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
              ' <img src="' + product.product_image + '" style="height: 200px;object-fit: cover;"  class="card-img-top" alt="...">' +
              ' <div class="card-body" style="position: relative;">' +
              '<div class="row"><div class="col-6"> <h5 class="card-title text-left" style="font-family: \'Lato\', sans-serif;">' + product.name + '</h5></div>' +
              '<div class="col-6"><p class="card-text  text-right" style="font-weight:bold;text-align:right">CAD ' + product.price + '</p></div></div>' +
              '<p class="card-text truncate-text">' + product.description + '</p> ' +
              ' <a href="../productDetails/index.html?p_id='+product.id+'" class="btn btn-product justify-content-center" style="width:100%">View Detail</a></div>'
          }

          else if (product.category == selectedValue) {

            productcategoryHTML += '<div class="col-lg-4 col-md-6 col-sm-12  p-3"><div class="card" style="box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
              ' <img src="' + product.product_image + '" style="height: 200px;object-fit: cover;"  class="card-img-top" alt="...">' +
              ' <div class="card-body" style="position: relative;">' +
              '<div class="row"><div class="col-6"> <h5 class="card-title text-left" style="font-family: \'Lato\', sans-serif;">' + product.name + '</h5></div>' +
              '<div class="col-6"><p class="card-text  text-right" style="font-weight:bold;text-align:right">CAD ' + product.price + '</p></div></div>' +
              '<p class="card-text truncate-text">' + product.description + '</p> ' +
              ' <a href="../productDetails/index.html?p_id='+product.id+'" class="btn btn-product justify-content-center" style="width:100%">View Detail</a></div>' 

          }

          productcategoryHTML += '</div></div>'
        });

        document.getElementById('products').innerHTML = productcategoryHTML;

        // console.log(productcategoryHTML);


      }
      xhttp.open("GET", "http://localhost:3000/product", true);
      xhttp.send();

      var order = document.getElementById("select-price-category");
      order = order.value;

if(order!=-1){
  price_category_filter();
}
    }


    function price_category_filter(){


      var order = document.getElementById("select-price-category");

       order = order.value;

       if(order=="lth"){
        order="asc"
       }
       else if(order==-1){

       }
       else
       {
        order="desc"
       }
      let cid;
      var selectElement = document.getElementById("select-category");

var selectedValue = selectElement.value;
      if(selectedValue==-1){
        let queryParams = new URLSearchParams(window.location.search);

        cid = queryParams.get("c_id");  
      }
      else {
        var selectElement = document.getElementById("select-category");

        cid = selectElement.value;

      }


 const xhttp = new XMLHttpRequest();
      xhttp.onload = function () {

        var responseJsonObj = JSON.parse(this.responseText);
        //console.log(responseJsonObj);
        let productcategoryHTML = '';
        responseJsonObj.forEach(product => {

            productcategoryHTML += '<div class="col-lg-4 col-md-6 col-sm-12  p-3"><div class="card" style="box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
              ' <img src="' + product.product_image + '" style="height: 200px;object-fit: cover;"  class="card-img-top" alt="...">' +
              ' <div class="card-body" style="position: relative;">' +
              '<div class="row"><div class="col-6"> <h5 class="card-title text-left" style="font-family: \'Lato\', sans-serif;">' + product.name + '</h5></div>' +
              '<div class="col-6"><p class="card-text  text-right" style="font-weight:bold;text-align:right">CAD ' + product.price + '</p></div></div>' +
              '<p class="card-text truncate-text">' + product.description + '</p> ' +
              ' <a href="../productDetails/index.html?p_id='+product.id+'" class="btn btn-product justify-content-center" style="width:100%">View Detail</a></div>' 

          productcategoryHTML += '</div></div>'
        });

        document.getElementById('products').innerHTML = productcategoryHTML;

        // console.log(productcategoryHTML);


      }
      if(cid=="all"){
        xhttp.open("GET", "http://localhost:3000/product?_sort=price&_order="+order, true);
      }
      else{
      xhttp.open("GET", "http://localhost:3000/product?category="+cid+"&_sort=price&_order="+order, true);
      }
      xhttp.send();





    }


    function apply(){
      const priceRange = document.getElementById('priceRange');
      const value = priceRange.value;

     

      var order = document.getElementById("select-price-category");

       order = order.value;

       if(order=="lth"){
        order="asc"
       }
       else if(order==-1){

       }
       else
       {
        order="desc"
       }
      let cid;
      var selectElement = document.getElementById("select-category");

var selectedValue = selectElement.value;
      if(selectedValue==-1){
        let queryParams = new URLSearchParams(window.location.search);

        cid = queryParams.get("c_id");  
      }
      else {
        var selectElement = document.getElementById("select-category");

        cid = selectElement.value;

      }


 const xhttp = new XMLHttpRequest();
      xhttp.onload = function () {

        var responseJsonObj = JSON.parse(this.responseText);
        //console.log(responseJsonObj);
        let productcategoryHTML = '';
        responseJsonObj.forEach(product => {

          if(product.price<=value){

            productcategoryHTML += '<div class="col-lg-4 col-md-6 col-sm-12  p-3"><div class="card" style="box-shadow: 0 5px 15px rgba(0,0,0,0.1);">' +
              ' <img src="' + product.product_image + '" style="height: 200px;object-fit: cover;"  class="card-img-top" alt="...">' +
              ' <div class="card-body" style="position: relative;">' +
              '<div class="row"><div class="col-6"> <h5 class="card-title text-left" style="font-family: \'Lato\', sans-serif;">' + product.name + '</h5></div>' +
              '<div class="col-6"><p class="card-text  text-right" style="font-weight:bold;text-align:right">CAD ' + product.price + '</p></div></div>' +
              '<p class="card-text truncate-text">' + product.description + '</p> ' +
              ' <a href="../productDetails/index.html?p_id='+product.id+'" class="btn btn-product justify-content-center" style="width:100%">View Detail</a></div>' 
          productcategoryHTML += '</div></div>'
              }
        });

        document.getElementById('products').innerHTML = productcategoryHTML;

        // console.log(productcategoryHTML);


      }
      if(cid=="all"){
        xhttp.open("GET", "http://localhost:3000/product?_sort=price&_order="+order, true);
      }
      else{
      xhttp.open("GET", "http://localhost:3000/product?category="+cid+"&_sort=price&_order="+order, true);
      }
      xhttp.send();







    }

  </script>
</body>

</html>